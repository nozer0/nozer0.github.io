<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="utf-8">
	<title>如何使用Git</title>
	<!-- <meta name="keywords" content=""> -->
	<meta name="description" content="Git使用笔记, 可做简单手册检索.">
	<meta name="author" content="nozer0">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="robots" content="all">

	<link rel="stylesheet" type="text/css" href="/assets/default/css/style.css">

	<!-- atom & rss feed
	<link href="" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
	<link href="" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">
	-->

	<!-- Le fav and touch icons -->
	<!-- Update these with your own images
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
	-->

	<!-- HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
</head>
<body>
	
	

	<header class="navbar">
	<a class="brand" href="/">
		nozer0's blog
		<div class="tagline">Life may has Zero, but thought never</div>
	</a>
	
		<a href="/en/">英文</a>
	
	<nav>
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
				
      				<a href="/zh/archive/">档案</a>
      			
      		
		
			
				
      				<a href="/zh/categories/">分类</a>
      			
      		
		
			
		
			
				
      				<a href="/zh/tags/">标签</a>
      			
      		
		
	</nav>
</header>
	<aside></aside>
	


<article class="post">
	
	
	<nav>
	
		&raquo;
		
			<a href="/zh/categories">分类</a>
		
	
		&raquo;
		
			<a href="/zh/categories/#program">编程</a>
		
	
	</nav>
	

	<h1>
		如何使用Git
		
			
		
		
			<a href=/en/program/how-to-use-git/>&</a>
		
			
		
			
		
	</h1>

	<div>
		<span class="date">2014-03-04</span>
		by <a href="mailto:c.nozer0@gmail.com">nozer0</a>
	</div>
	<div class="content"><p>分享本人在使用Git的过程中积累的一些笔记。</p>

<p>简单索引:</p>

<ul>
<li>
<p><a href="#launch_"><code>git clone &lt;仓库地址&gt;</code> -&gt; 首先，我们要从远程仓库取得数据。</a></p>
</li>

<li>
<p><a href="#working_cycle_">如何更改数据。</a></p>

<ol>
<li><a href="#update"><code>git fetch</code> -&gt; 从远程仓库更新数据到本地仓库。</a></li>

<li><a href="#update"><code>git checkout</code> -&gt; 从本地仓库检出到工作目录。</a></li>

<li><a href="#change"><code>git add &lt;new files&gt;</code> -&gt; 新增文件加入版本控制。</a></li>

<li><a href="#revert"><code>git reset</code> -&gt; 撤销未提交的改动。</a></li>

<li><a href="#commit"><code>git commit</code> -&gt; 提交修改到本地仓库。</a></li>

<li><a href="#commit"><code>git push</code> -&gt; 同步本地仓库更改到远程。</a></li>
</ol>
</li>

<li>
<p><a href="#branch_">分支</a></p>

<ol>
<li><code>git branch &lt;name&gt; &lt;commit&gt;</code> -&gt; 创建分支。</li>

<li><code>git merge &lt;name&gt;</code> -&gt; 合并由’name’指定分支的更改。</li>

<li><code>git cherry-pick &lt;commit&gt;</code> -&gt; 选择复制指定的提交。</li>

<li><code>git rebase &lt;src&gt; &lt;dest&gt;</code> -&gt; 复制’dest’的提交到’src’。</li>

<li><code>git branch -d &lt;name&gt;</code> -&gt; 删除废弃分支。</li>

<li><code>git checkout &lt;name&gt;</code> -&gt; 切换到另一分支。</li>
</ol>
</li>

<li>
<p><a href="#tag_">标签</a></p>
</li>

<li>
<p><a href="#auxiliary_commands_"><code>git status</code>, <code>git diff</code>, … -&gt; 一些帮助检查版本信息之类的辅助命令。</a></p>
</li>

<li>
<p><a href="#additional_info_">附带内容</a></p>
</li>

<li>
<p><a href="#compare_table">SVN对比表</a></p>
</li>
</ul>
<hr />
<h1 id="install_">安装(Install) <a href="#">↑</a></h1>

<p>安装Git最简单的方法就是从<a href="http://git-scm.com/downloads">官网</a>下载安装程序。</p>

<p>或者我们也可以选择使用一些安装包管理工具，比如Debian的’apt-get’，或OSX下的’port’和’brew’之类。在安装前请先确认是否已安装所需的其他组件。</p>

<pre><code># ubuntu
apt-get install git
# mac
brew install git</code></pre>

<p>如果是之前已经安装了Git，可以使用以下命令进行升级。</p>

<pre><code>git clone git://git.kernel.org/pub/scm/git/git.git</code></pre>
<hr />
<h1 id="setup_">配置(Setup) <a href="#">↑</a></h1>

<p>在开始使用Git之前，我们需要先设置一些相关信息。</p>

<pre><code># 将&#39;nozer0&#39;和&#39;c.nozer0@gmail.com&#39;替换成你的信息
git config --global user.name nozer0
git config --global user.email c.nozer0@gmail.com</code></pre>

<p>或者用编辑器一次性更改所有配置。</p>

<pre><code>git config --global -e</code></pre>
<hr />
<h1 id="launch_">开始(Launch) <a href="#">↑</a></h1>

<p>通常我们需要先从远程仓库中取得数据，这个操作和其他如CVS或Subversion之类的VCS的’checkout’操作非常类似。</p>

<pre><code># 克隆远程仓库
git clone https://github.com/nozer0/one-piece.git
git clone /usr/local/codes/one-piece ./op

# 克隆分支&#39;branch1&#39;
git clone -b branch1 https://github.com/nozer0/one-piece.git</code></pre>

<p>或者，我们也可以选择初始化一个目录后，再设置需要连接的远程仓库。</p>

<pre><code># 创建&#39;.git&#39;目录
git init
git remote add origin https://github.com/nozer0/one-piece.git</code></pre>
<hr />
<h1 id="working_cycle_">工作循环(Working cycle) <a href="#">↑</a></h1>

<p>由于Git是所谓的DVCS（分布式版本控制系统），所以拥有本地仓库，和另外一个称之为’index’或’staged’的区域，用来保存那些跟踪但还未提交的文件信息。相对的，那些新增或修改的还没有进入版本控制的文件，我们称之为’unstaged’文件。</p>

<pre><code>+---------+   add   +-------+  commit  +------------+  push   +------------+
| Working | ------&gt; | Index | -------&gt; |   Local    | ------&gt; |   Remote   |
|  Area   | &lt;------ | Area  |          | Repository | &lt;------ | Repository |
+---------+  reset  +-------+          +------------+  fetch  +------------+
     ^                  ^      checkout       |
     +------------------+---------------------+</code></pre>

<h2 id="update">更新(Update)</h2>

<p>首先，我们要从远程仓库将最新代码更新到本地。</p>

<p>第一步，使用<code>git fetch</code>命令将代码同步到本地仓库。</p>

<pre><code>git fetch
# 从远程取得&#39;origin/master~2&#39;为止的commit数据到本地&#39;foo&#39;分支
git fetch origin master~2:foo</code></pre>

<p>然后，我们可以选择合并(merge)还是衍合(rebase)远程数据，或者直接检出远程数据覆盖工作目录。可以在下一节<a href="#branch_">分支</a>看到更详细的说明。</p>

<pre><code># 保留本地修改时使用合并
git merge origin/master
# 或者直接应用远程数据
git checkout origin/master</code></pre>

<p>Git还提供了一个一步到位的命令，<code>git pull</code>。</p>

<pre><code># 等同于`git fetch`以及`git merge FETCH_HEAD`
git pull
# 采用衍合代替合并
git pull --rebase
# 也支持类似fetch的复杂格式
git pull origin foo:bar</code></pre>

<h2 id="change">更改(Change)</h2>

<p>OK，现在我们可以开始在工作目录中做更改，并使用<code>git add</code>或其他的命令提交到index区域。</p>

<pre><code># 在前后都使用`git status`，看看有何不同
# 修改
git status
git add test.txt
git status

# 只影响index
git rm old.txt --cached
# 同时从index和工作目录删除
git rm unused.txt

# 重命名文件
git mv old.c new.c
# 等效写法
mv old.c new.c
git rm old.c
git add new.c</code></pre>

<h2 id="revert">回复(Revert)</h2>

<p>有时候，我们可能提交失误，或者想回复最近的更改，Git同样提供了相应的命令来回复更改。</p>

<pre><code># 回复index，但保留工作目录中的更改
git reset text.txt
# 回复到前2个提交时的状态
git reset HEAD~2
# 如果是在&#39;master&#39;分支，等效的写法
git branch -f master HEAD~2

# 或者同时回复index和工作目录
git reset --hard</code></pre>

<h2 id="commit">提交(Commit)</h2>

<p>比起其他的VCS，Git多了个本地仓库，我们需要比普通的提交多一个步骤以将更改提交到远程。</p>

<p>如果所有的更改已经是’staged’状态，就像一般的做法一样，我们可以用<code>git commit</code>将更改提交到本地仓库。</p>

<pre><code>git commit -m &#39;first commit&#39;
# 如果文件之前已经递交到index，可以省略`git add`步骤
git commit -am &#39;commit again&#39; test.txt</code></pre>

<p>如果我们在提交后发现遗漏了某些更改或文件，可以使用下面的命令修改最近的一次提交。</p>

<pre><code>git commit --amend</code></pre>

<p>要注意的是，如果文件之前已经是’staged’，提交时会采用工作目录的版本，而不是index中的版本。比如</p>

<pre><code>echo 1 &gt; test
git add test
echo 2 &gt;&gt; test
# 提交的内容是&#39;1 2&#39;
git commit test -m &#39;test file&#39;</code></pre>

<p>当我们需要将本地仓库的更改提交到远程仓库时，请使用<code>git push</code>命令。</p>

<pre><code>git push
# 同步&#39;HEAD~2&#39; commit到远程的&#39;origin/foo&#39;分支
git push origin HEAD~2:foo</code></pre>
<hr />
<h1 id="branch_">分支(Branch) <a href="#">↑</a></h1>

<p>在Git中，分支好比一个指向某个commit的别名，因此在Git中，分支的使用频率相当高，开发新功能时，我们使用分支；修复bug，还是分支，其他很多的情况，同样是分支。总之，’branch early, and branch often’（早用多用 @_@!! ）。</p>

<pre><code># 显示所有分支
git branch -a
# 基于&#39;HEAD~2&#39;创建分支&#39;new&#39;
git branch new HEAD~2
# 重命名&#39;new&#39;为&#39;branch1&#39;
git branch -m new branch1
# 将&#39;branch1&#39;指向&#39;afe9...&#39;
git branch -f branch1 afe9
# 删除&#39;branch1&#39;
git branch -d branch1</code></pre>

<p>实际使用时，我们会同时存在很多分支，这就需要使用<code>git checkout</code>在不同分支间切换。</p>

<pre><code># 切换到master分支并更新index，同时HEAD也指向该分支
git checkout master
# 创建一个分支后，立即切换到刚创建的分支
git checkout -b branch2 HEAD~2
# 合并branch2到master，并切换到master
git checkout -B master branch2</code></pre>

<p>在需要重新排布分支时，Git提供了<code>merge</code>，<code>rebase</code>和<code>cherry-pick</code>三种不同模式。让我们用具体的例子来看到底有何区别。</p>

<pre><code># C0--C1 &lt;- master*
#  \
#  C2--C3 &lt;- develop

git merge develop
# C0--C1--C4 &lt;- master*
#  \     /
#  C2--C3 &lt;- develop
# 如果合并时有冲突，我们可以回复到合并前状态
git merge --abort

git rebase master develop
#      C2&#39;--C3&#39; &lt;- develop*
#      /
# C0--C1 &lt;- master
#  \
#  C2--C3
# 使用&#39;-i&#39;选项后，可开启衍合(rebase)的交互模式

git cherry-pick C2 C3
# C0--C1--C2&#39;--C3&#39; &lt;- master*
#  \
#  C2--C3 &lt;- develop</code></pre>
<hr />
<h1 id="tag_">标签(Tag) <a href="#">↑</a></h1>

<p>标签是另一种指向commit的别名，通常用来标注某一个里程碑，开发版本之类的的东东，和’Branch’很相似。</p>

<pre><code># 显示所有标签
git tag -a
# 给HEAD~2打上‘v1.0&#39;标签
git tag v1.0 HEAD~2
# 重新打标签
git tag -f v1.0 HEAD
# 删除标签
git tag -d v1.0-test</code></pre>
<hr />
<h1 id="auxiliary_commands_">辅助命令(Auxiliary Commands) <a href="#">↑</a></h1>

<p>之前我们已经使用过了<code>git status</code>命令，我们还可以用<code>git log</code>命令来查看更多的历史信息。</p>

<pre><code>git log
# 显示详细的diff信息
git log -p
# 显示统计diff信息
git log --stat
# 显示最近的n条日志
git log -2
# 只显示符合条件的日志
git log --since=&lt;time&gt;</code></pre>

<p>我们也可以使用<code>git diff</code>命令来比较两个状态的不同。</p>

<pre><code># 比较index和工作目录
git diff
# 比较已提交的更改和index
git diff --cached
# 比较HEAD和工作目录
git diff HEAD</code></pre>

<p><code>git show</code>和<code>git blame</code>可以让我们查看更进一步的具体信息。</p>

<pre><code>git show 4c18
# 显示每一行的相关信息
git blame readme.txt
# 输出:
# 	^4c18e3c (nozer0 2014-03-05 14:17:44 +0800  1) hi
# 	^4c18e3c (nozer0 2014-03-05 14:17:44 +0800  1) I&#39;m nozer0</code></pre>
<hr />
<h1 id="additional_info_">附带内容(Additional Info) <a href="#">↑</a></h1>

<p>提交(Commit)，是Git中最重要的概念，我们会在许多命令中需要指定相关的commit，有多种不同的方式来表示一个commit。假设，我们目前的提交如下。</p>

<pre><code>   v1 (tag)
      |
+-----------+     +-----------+
| a9e82f... | --- | 39e768... | &lt;- master* (branch)
+-----------+     +-----------+
               /
+-----------+
| 36bc54... |
+-----------+</code></pre>

<p>‘HEAD’也是Git的保留关键字，与其他如SVN之类的VCS不同的是，HEAD代表的是目前工作目录相关的commit。比如上面所举的那个例子，’HEAD’就是指’master’。所以，如果我们需要指定’a9e82f…‘，等效的写法可以是’a9e8’、’v1’、’master~’以及’HEAD^’，而’36bc’和’master^2’可以指代’36bc54…‘。其中’~’和’^’的区别，’~’代表的是上溯的步数，而’^’代表的是上溯的分支，也可以组合使用，例如，’HEAD^2~3’。</p>

<h2 id="compare_table">对比表(Compare Table)</h2>

<p>下面列举了SVN和Git相似的命令，以便于之前使用过SVN的同学理解。</p>
<table><thead><tr><th>SVN</th><th>Git</th></tr></thead><tbody><tr><td style="text-align: right;"><code>svn checkout</code></td><td style="text-align: left;"><code>git clone</code></td></tr>
<tr><td style="text-align: right;"></td><td style="text-align: left;"></td></tr>
<tr><td style="text-align: right;"><code>svn update</code></td><td style="text-align: left;"><code>git pull</code>, <code>git fetch</code> + <code>git checkout</code></td></tr>
<tr><td style="text-align: right;"><code>svn add</code></td><td style="text-align: left;"><code>git add</code></td></tr>
<tr><td style="text-align: right;"><code>svn move</code></td><td style="text-align: left;"><code>git move</code></td></tr>
<tr><td style="text-align: right;"><code>svn revert</code></td><td style="text-align: left;"><code>git reset --hard</code></td></tr>
<tr><td style="text-align: right;"><code>svn commit</code></td><td style="text-align: left;"><code>git commit</code> + <code>git push</code></td></tr>
<tr><td style="text-align: right;"></td><td style="text-align: left;"></td></tr>
<tr><td style="text-align: right;"><code>svn status</code></td><td style="text-align: left;"><code>git status</code></td></tr>
<tr><td style="text-align: right;"><code>svn diff</code></td><td style="text-align: left;"><code>git diff</code></td></tr>
<tr><td style="text-align: right;"><code>svn log</code></td><td style="text-align: left;"><code>git log</code></td></tr>
<tr><td style="text-align: right;"></td><td style="text-align: left;"></td></tr>
<tr><td style="text-align: right;"><code>svn copy &lt;src&gt; &lt;branch path&gt;</code></td><td style="text-align: left;"><code>git branch &lt;branch name&gt; &lt;commit&gt;</code></td></tr>
<tr><td style="text-align: right;"><code>svn rm &lt;branch path&gt;</code></td><td style="text-align: left;"><code>git branch -d &lt;branch name&gt;</code></td></tr>
<tr><td style="text-align: right;"><code>svn merge &lt;path&gt;</code></td><td style="text-align: left;"><code>git merge &lt;name&gt;</code></td></tr>
<tr><td style="text-align: right;"><code>svn merge -r&lt;rev&gt; &lt;path&gt;</code></td><td style="text-align: left;"><code>git cherry-pick &lt;commit&gt;</code></td></tr>
</tbody></table><hr />
<p>推荐一个很有意思的<a href="http://pcottle.github.io/learnGitBranching/">网站</a>。</p></div>

	
	
	


<div class="tags_box">

	<a href="/zh/tags/#VCS">VCS <small>2</small></a>

	<a href="/zh/tags/#Git">Git <small>1</small></a>

	<a href="/zh/tags/#note">note <small>2</small></a>

</div>
	

	<hr>
	<div class="pagination">
	
	
		
	
		
			
				
				
				<a class="prev" href="/zh/program/how-to-use-svn/" title="如何使用SVN">&larr; 如何使用SVN</a>
			

			
				<a class="next disabled">&rarr; 后篇</a>
			
		
	
	</div>
</article>
	<footer>
	&copy; 2014 ~ <br>
	<a href="mailto:c.nozer0@gmail.com">nozer0</a>
</footer>
</body>
</html>